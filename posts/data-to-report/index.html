<!DOCTYPE html>
<html>
  <head>
    
    
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
  Data to Report &ndash; DevOps journey

    </title>
    
    <meta content="report, executor, data, manager, sql, file, ldap" name="keywords">
    
    
    <meta name="description" property="og:description" content="Task report In the life of every system manager, sooner or later it has happened to do reporting, or by collecting data from logs, databases as diverse as LDAP servers.
The thing you will surely have done is to collect data manually, using tools like grep and awk for configuration files and logs.
$ cat example.log | grep &#39;ERROR&#39; $ awk &#39;{print $2}&#39; example.log Or a bash script that analyzes each row and then selects only those of interest.|">
    

    <meta name="apple-mobile-web-app-title" content="DevOps journey">
    
    
    <link rel="icon" href="https://matteoguadrini.github.iofavicon-64.png">
    <link rel="apple-touch-icon" href="https://matteoguadrini.github.ioapple-touch-icon.png">
    <link rel="mask-icon" size="any" href="https://matteoguadrini.github.iopinned-icon.svg">
    
    
    


    <link rel="stylesheet" href="/assets/syntax.css">
    <link rel="stylesheet" href="/assets/primer-build.css">
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="/assets/custom_style.css">
  </head>


  <body class="bg-gray">
    <div id="holy" class="container-lg bg-white h-100">

      <div id="header" class="px-1 bg-white">
        <nav class="UnderlineNav UnderlineNav--right px-2">
  <a class="UnderlineNav-actions muted-link h2" href="https://matteoguadrini.github.io">
    DevOps journey
  </a>

  
  
  <div class="UnderlineNav-body">
    
    
    
    <a class="UnderlineNav-item" href="/about/">
      
      <span>About</span>
    </a>
    
    
    
    
    <a class="UnderlineNav-item" href="/tools/">
      
      <span>Tools</span>
    </a>
    
    
  </div>
  
</nav>

      </div>

      <div role="main" id="main" class="holy-main markdown-body px-4 bg-white">
        

<div class="Subhead">
  <div class="Subhead-heading">
    <div class="h1 mt-3 mb-1">Data to Report</div>
  </div>
  <div class="Subhead-description">
    


<a href='/categories/devops' class="muted-link">
  <span class="Label Label--gray-darker">devops</span>
</a>

<a href='/categories/system' class="muted-link">
  <span class="Label Label--gray-darker">system</span>
</a>

<a href='/categories/developer' class="muted-link">
  <span class="Label Label--gray-darker">developer</span>
</a>



<a href='/tags/report' class="muted-link">
  <span class="Label Label--gray">report</span>
</a>

<a href='/tags/python' class="muted-link">
  <span class="Label Label--gray">python</span>
</a>

<a href='/tags/bash' class="muted-link">
  <span class="Label Label--gray">bash</span>
</a>

<a href='/tags/data' class="muted-link">
  <span class="Label Label--gray">data</span>
</a>



    
    <div class="float-md-right">
      <span title="Lastmod: 2021-07-25. Published at: 2021-07-25.">
        
          Published: 2021-07-25
        
      </span>
    </div>
    
  </div>
</div>
<article>
  
  <section class="pb-6 mb-3 border-bottom">
    <p><img src="https://www.vistaprojects.com/media/2020/12/engineeringreports2-768x419.png" alt="report"></p>
<h2 id="task-report">Task report</h2>
<p>In the life of every system manager, sooner or later it has happened to do reporting, or by collecting data from <em>logs</em>, <em>databases</em> as diverse as <em>LDAP</em> servers.</p>
<p>The thing you will surely have done is to collect data manually, using tools like <code>grep</code> and <code>awk</code> for configuration files and logs.</p>
<pre><code class="language-console" data-lang="console">$ cat example.log | grep 'ERROR'
$ awk '{print $2}' example.log
</code></pre><p>Or a <code>bash</code> script that analyzes each row and then selects only those of interest. But sometimes, the logs don&rsquo;t have the same format, or there is a need for a multiple log provider or worse, multiple sources.</p>
<p>These are excellent techniques but it really takes a long time to write such complex scripts and above all, if the formats were to change one day, put our scripts back in hand.</p>
<p>Ok, but then how to do it?</p>
<h2 id="pyreports">Pyreports</h2>
<p>Again, <em>Python</em> comes to our aid. With the <a href="https://github.com/MatteoGuadrini/pyreports"><strong>pyreports</strong></a> module it is possible to carry out simple and complex reports, from one source or with multiple sources. Any data you can extract from a file or database (including LDAP) with <em>pyreports</em> is possible. In addition, this tool also offers utilities for data processing. But let&rsquo;s see in detail how it can help us.</p>
<pre><code class="language-console" data-lang="console">$ pip install pyreports		# for installation
</code></pre><h3 id="datasets">Datasets</h3>
<p><em>Pyreports</em> treats the data in object <a href="https://tablib.readthedocs.io/en/stable/"><strong>dataset</strong></a>, to simplify the manipulation of the same.
To do this, it has two core objects that are used for data extraction and processing. First of all, we extract data from a source thanks to the <em>Manager</em> objects.</p>
<h3 id="managers">Managers</h3>
<p><strong>Managers</strong> can be of three types: database, file and LDAP. Each type of manager can implement different functionalities for extracting data. Let&rsquo;s go through each manager to see how to extract the data:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyreports</span>

<span class="c1"># DatabaseManager object</span>
<span class="n">sqllite_db</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;sqllite&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;/tmp/mydb.db&#39;</span><span class="p">)</span>
<span class="n">mssql_db</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;mssql&#39;</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s1">&#39;mssql1.local&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dba&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dba0000&#39;</span><span class="p">)</span>
<span class="n">mysql_db</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;mysql1.local&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dba&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dba0000&#39;</span><span class="p">)</span>
<span class="n">postgresql_db</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;postgresql&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;postgresql1.local&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dba&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dba0000&#39;</span><span class="p">)</span>

<span class="c1"># FileManager object</span>
<span class="nb">file</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/log.log&#39;</span><span class="p">)</span>
<span class="n">csv</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/csv.csv&#39;</span><span class="p">)</span>
<span class="n">json</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/json.json&#39;</span><span class="p">)</span>
<span class="n">yaml</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/yaml.yml&#39;</span><span class="p">)</span>
<span class="n">xlsx</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/xlsx.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># LdapManager object</span>
<span class="n">ldap</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;ldap&#39;</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s1">&#39;ldap.local&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tls</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div><p>Once we have a dataset, we move on to data processing, through an <em>Executor</em>.</p>
<h3 id="executors">Executors</h3>
<p><strong>Executor</strong> objects are built with a python base or a dataset.
Once we have an Executor object, we can apply filters and data mappings. Here is an example for our database: explanation
However, we haven&rsquo;t extracted the data to any files yet. Let&rsquo;s create an additional manager object to save the data to an output file.</p>
<p>In a few lines we have created an effective reporting script, readable and not susceptible to changes in the original data structure.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyreports</span>

<span class="c1"># Create a data source</span>
<span class="n">mydb</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">manager</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;mysql1.local&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;dba&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dba0000&#39;</span><span class="p">)</span>

<span class="c1"># Get data</span>
<span class="n">mydb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM salary&#39;</span><span class="p">)</span>
<span class="n">employees</span> <span class="o">=</span> <span class="n">mydb</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>                 <span class="c1"># return Dataset object</span>

<span class="c1"># Create Executor object</span>
<span class="n">myex</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">Executor</span><span class="p">(</span><span class="n">employees</span><span class="p">)</span>        <span class="c1"># The employees object already has a header, as it was created by a database manager</span>
</code></pre></div><p>However, there is an object in <em>pyreports</em> that simplifies these steps; that is, it creates for us the data processing process: the <em>Report</em> object.
Let&rsquo;s see how it works.</p>
<h3 id="reports">Reports</h3>
<p>As the official documentation says, the <strong>Report</strong> objects are:</p>
<blockquote>
<p>The Report object provides an interface for a complete workflow-based report (see <a href="https://pyreports.readthedocs.io/en/latest/index.html#workflow">Report workflow</a>).</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyreports</span>
<span class="kn">import</span> <span class="nn">tablib</span>

<span class="c1"># Instantiate a simple Report object</span>
<span class="n">mydata</span> <span class="o">=</span> <span class="n">tablib</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([(</span><span class="s1">&#39;Arthur&#39;</span><span class="p">,</span> <span class="s1">&#39;Dent&#39;</span><span class="p">,</span> <span class="mi">55000</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Ford&#39;</span><span class="p">,</span> <span class="s1">&#39;Prefect&#39;</span><span class="p">,</span> <span class="mi">65000</span><span class="p">)],</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;salary&#39;</span><span class="p">])</span>
<span class="n">myrep</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">Report</span><span class="p">(</span><span class="n">mydata</span><span class="p">)</span>

<span class="c1"># View report</span>
<span class="n">myrep</span>           <span class="c1"># repr(myrep)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myrep</span><span class="p">)</span>    <span class="c1"># str(myrep)</span>
</code></pre></div><p>There is another object that is used to collect <em>Report</em> objects and automate in turn many data processing processes in a single excel file with multiple sheets. This object is <strong>ReportBook</strong>.
As the official documentation says, the ReportBook objects are:</p>
<blockquote>
<p>The ReportBook object is a collection (list) of Report objects. This basically allows you to collect multiple reports in a single container object. The main advantage is the ability to iterate over each Report and access its properties.
Let&rsquo;s see how it works below.</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyreports</span>
<span class="kn">import</span> <span class="nn">tablib</span>

<span class="c1"># Instantiate the Report objects</span>
<span class="n">mydata</span> <span class="o">=</span> <span class="n">tablib</span><span class="o">.</span><span class="n">Dataset</span><span class="p">([(</span><span class="s1">&#39;Arthur&#39;</span><span class="p">,</span> <span class="s1">&#39;Dent&#39;</span><span class="p">,</span> <span class="mi">55000</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Ford&#39;</span><span class="p">,</span> <span class="s1">&#39;Prefect&#39;</span><span class="p">,</span> <span class="mi">65000</span><span class="p">)],</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;salary&#39;</span><span class="p">])</span>
<span class="n">report_only_55k</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">Report</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">55000</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Report salary 55k&#39;</span><span class="p">)</span>
<span class="n">report_only_65k</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">Report</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">65000</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Report salary 65k&#39;</span><span class="p">)</span>

<span class="c1"># Create a ReportBook</span>
<span class="n">salary</span> <span class="o">=</span> <span class="n">pyreports</span><span class="o">.</span><span class="n">ReportBook</span><span class="p">([</span><span class="n">report_only_55k</span><span class="p">,</span> <span class="n">report_only_65k</span><span class="p">])</span>

<span class="c1"># View ReportBook</span>
<span class="n">salary</span>           <span class="c1"># repr(salary)</span>
<span class="k">print</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>    <span class="c1"># str(salary)</span>
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Also in this case, simplicity wins over complexity; if you need to perform simple reporting do not hesitate, use <em>bash</em>, <em>awk</em>, <em>sed</em> and all the command line tools that are easy to use.
But if you have to work on multiple databases, crossing them, processing them and filtering them, then python and pyreports meet our needs, simplifying our work.
Now it&rsquo;s your turn, process data!</p>

  </section>

  <section>
    
      
    
  </section>
</article>

      </div>

      <div id="side" class="pr-1 bg-white">
        <aside class="pr-3">
          
  
    <div id="toc" class="Box Box--blue mb-3">
      <b>Data to Report</b><nav id="TableOfContents">
  <ul>
    <li><a href="#task-report">Task report</a></li>
    <li><a href="#pyreports">Pyreports</a>
      <ul>
        <li><a href="#datasets">Datasets</a></li>
        <li><a href="#managers">Managers</a></li>
        <li><a href="#executors">Executors</a></li>
        <li><a href="#reports">Reports</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav></div>
  

  
    
    
      <div>
        
          <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        

        
          <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button&size=small&mobile_iframe=true&width=61&height=20&appId" width="61" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>
        

        

        
          <a data-pocket-label="pocket" data-pocket-count="none" class="pocket-btn" data-lang="en"></a>
          <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        

      </div>
    
  

        </aside>
      </div>

      <div id="footer" class="pt-2 pb-3 bg-white text-center">
        

  <span class="text-small text-gray">
    © Matteo Guadrini &middot; 

    Powered by the
    <a href="https://github.com/qqhann/hugo-primer" class="link-gray-dark">Hugo-Primer</a> theme for
    <a href="https://gohugo.io" class="link-gray-dark">Hugo</a>.
  </span>


      </div>
    </div>

    
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>
    
  </body>
</html>
